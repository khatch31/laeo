================================================================
ImportError: /iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/
courier/python/py_client.so: undefined symbol: _ZN4absl12lts_2021032414ascii_internal13kPropertyBitsE
================================================================

Traceback (most recent call last):
  File "/iris/u/khatch/contrastive_rl/lp_contrastive_goals.py", line 48, in <module>
    import contrastive
  File "/iris/u/khatch/contrastive_rl/contrastive/__init__.py", line 18, in <module>
    from contrastive.agents import DistributedContrastive
  File "/iris/u/khatch/contrastive_rl/contrastive/agents.py", line 21, in <module>
    from acme import specs
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/acme/__init__.py", line 35, in <module>
    from acme.environment_loop import EnvironmentLoop
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/acme/environment_loop.py", line 26, in <module>
    from acme.utils import signals
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/acme/utils/signals.py", line 22, in <module>
    import launchpad
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/launchpad/__init__.py", line 36, in <module>
    from launchpad.nodes.courier.node import CourierHandle
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/launchpad/nodes/courier/node.py", line 21, in <module>
    import courier
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/courier/__init__.py", line 26, in <module>
    from courier.python.client import Client  # pytype: disable=import-error
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/courier/python/client.py", line 30, in <module>
    from courier.python import py_client
ImportError: /iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/courier/python/py_client.so: undefined symbol: _ZN4absl12lts_2021032414ascii_internal13kPropertyBitsE

pip install tensorflow==2.8.2

================================================================
AttributeError: module 'tensorflow.python.training.experimental.mixed_precision' has no attribute '_register_wrapper_optimizer_cls'
================================================================

Traceback (most recent call last):
  File "/iris/u/khatch/contrastive_rl/lp_contrastive_goals.py", line 48, in <module>
    import contrastive
  File "/iris/u/khatch/contrastive_rl/contrastive/__init__.py", line 18, in <module>
    from contrastive.agents import DistributedContrastive
  File "/iris/u/khatch/contrastive_rl/contrastive/agents.py", line 24, in <module>
    from contrastive import builder
  File "/iris/u/khatch/contrastive_rl/contrastive/builder.py", line 26, in <module>
    from acme.agents.jax import actor_core as actor_core_lib
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/acme/agents/jax/actor_core.py", line 22, in <module>
    from acme.jax import networks as networks_lib
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/acme/jax/networks/__init__.py", line 38, in <module>
    from acme.jax.networks.distributional import CategoricalHead
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/acme/jax/networks/distributional.py", line 27, in <module>
    tfd = tfp.distributions
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/tensorflow_probability/python/internal/lazy_loader.py", line 53, in __getattr__
    module = self._load()
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/tensorflow_probability/python/internal/lazy_loader.py", line 40, in _load
    module = importlib.import_module(self.__name__)
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/tensorflow_probability/substrates/jax/__init__.py", line 41, in <module>
    from tensorflow_probability.substrates.jax import bijectors
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/tensorflow_probability/substrates/jax/bijectors/__init__.py", line 19, in <module>
    from tensorflow_probability.substrates.jax.bijectors.absolute_value import AbsoluteValue
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/tensorflow_probability/substrates/jax/bijectors/absolute_value.py", line 17, in <module>
    from tensorflow_probability.python.internal.backend.jax.compat import v2 as tf
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/tensorflow_probability/python/internal/backend/jax/__init__.py", line 18, in <module>
    from tensorflow_probability.python.internal.backend.jax import bitwise
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/tensorflow_probability/python/internal/backend/jax/bitwise.py", line 19, in <module>
    from tensorflow_probability.python.internal.backend.jax import _utils as utils
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/tensorflow_probability/python/internal/backend/jax/_utils.py", line 25, in <module>
    from tensorflow.python.ops import array_ops  # pylint: disable=g-direct-tensorflow-import,g-import-not-at-top,unused-import
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/tensorflow/__init__.py", line 473, in <module>
    keras._load()
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/tensorflow/python/util/lazy_loader.py", line 41, in _load
    module = importlib.import_module(self.__name__)
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/keras/__init__.py", line 25, in <module>
    from keras import models
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/keras/models.py", line 20, in <module>
    from keras import metrics as metrics_module
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/keras/metrics.py", line 27, in <module>
    from keras import activations
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/keras/activations.py", line 20, in <module>
    from keras.layers import advanced_activations
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/keras/layers/__init__.py", line 24, in <module>
    from keras.engine.input_layer import Input
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/keras/engine/input_layer.py", line 21, in <module>
    from keras.engine import base_layer
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/keras/engine/base_layer.py", line 41, in <module>
    from keras.mixed_precision import loss_scale_optimizer
  File "/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/keras/mixed_precision/loss_scale_optimizer.py", line 1180, in <module>
    mixed_precision._register_wrapper_optimizer_cls(optimizer_v2.OptimizerV2,
AttributeError: module 'tensorflow.python.training.experimental.mixed_precision' has no attribute '_register_wrapper_optimizer_cls'

pip uninstall keras-nightly


================================================================
TypeError: __init__() got an unexpected keyword argument 'checkpoint_time_delta_minutes'
================================================================

Traceback (most recent call last):
  File "/iris/u/khatch/contrastive_rl/lp_contrastive_goals.py", line 312, in <module>
    app.run(main)
  File "/iris/u/khatch/anaconda3/envs/crl/lib/python3.9/site-packages/absl/app.py", line 308, in run
    _run_main(main, args)
  File "/iris/u/khatch/anaconda3/envs/crl/lib/python3.9/site-packages/absl/app.py", line 254, in _run_main
    sys.exit(main(argv))
  File "/iris/u/khatch/contrastive_rl/lp_contrastive_goals.py", line 306, in main
    program = get_program(params)
  File "/iris/u/khatch/contrastive_rl/lp_contrastive_goals.py", line 184, in get_program
    return agent.build()
  File "/iris/u/khatch/contrastive_rl/contrastive/distributed_layout_goals.py", line 388, in build
    replay_node = lp.ReverbNode(self.replay, checkpoint_time_delta_minutes=5, checkpoint_ctor=r_checpointer)
TypeError: __init__() got an unexpected keyword argument 'checkpoint_time_delta_minutes'

pip install dm-launchpad==0.5.2


================================================================
Terrible CUDNN error

*** jaxlib.xla_extension.XlaRuntimeError: UNKNOWN: Failed to determine best cudnn convolution algorithm for:
AND
Profiling failure on cuDNN engine 0: UNKNOWN: CUDNN_STATUS_EXECUTION_FAILED
================================================================

2022-09-20 10:42:01.453478: E external/org_tensorflow/tensorflow/stream_executor/cuda/cuda_dnn.cc:377] Loaded runtime CuDNN library: 8.1.1 but source was compiled with: 8.2.4. CuDNN library needs to have matching major version and equal or higher minor version. If using a binary install, upgrade your CuDNN library. If building from sources, make sure the library loaded at runtime is compatible with the version specified during compile configuration.
2022-09-20 10:42:01.456672: E external/org_tensorflow/tensorflow/stream_executor/cuda/cuda_dnn.cc:377] Loaded runtime CuDNN library: 8.1.1 but source was compiled with: 8.2.4. CuDNN library needs to have matching major version and equal or higher minor version. If using a binary install, upgrade your CuDNN library. If building from sources, make sure the library loaded at runtime is compatible with the version specified during compile configuration.
2022-09-20 10:42:01.459094: E external/org_tensorflow/tensorflow/stream_executor/cuda/cuda_dnn.cc:377] Loaded runtime CuDNN library: 8.1.1 but source was compiled with: 8.2.4. CuDNN library needs to have matching major version and equal or higher minor version. If using a binary install, upgrade your CuDNN library. If building from sources, make sure the library loaded at runtime is compatible with the version specified during compile configuration.
....
*** jaxlib.xla_extension.XlaRuntimeError: UNKNOWN: Failed to determine best cudnn convolution algorithm for:
%cudnn-conv = (f32[1,16,16,32]{3,2,1,0}, u8[0]{0}) custom-call(f32[1,64,64,6]{3,2,1,0} %Arg_0.1, f32[8,8,6,32]{2,1,0,3} %copy), window={size=8x8 stride=4x4 pad=2_2x2_2}, dim_labels=b01f_01io->b01f, custom_call_target="__cudnn$convForward", metadata={op_name="jit(conv_general_dilated)/jit(main)/conv_general_dilated[window_strides=(4, 4) padding=((2, 2), (2, 2)) lhs_dilation=(1, 1) rhs_dilation=(1, 1) dimension_numbers=ConvDimensionNumbers(lhs_spec=(0, 3, 1, 2), rhs_spec=(3, 2, 0, 1), out_spec=(0, 3, 1, 2)) feature_group_count=1 batch_group_count=1 lhs_shape=(1, 64, 64, 6) rhs_shape=(8, 8, 6, 32) precision=None preferred_element_type=None]" source_file="/iris/u/khatch/anaconda3/envs/contrastive_rl/lib/python3.9/site-packages/haiku/_src/conv.py" source_line=205}, backend_config="{\"conv_result_scale\":1,\"activation_mode\":\"0\",\"side_input_scale\":0}"


AND

2022-09-21 12:07:27.004027: E external/org_tensorflow/tensorflow/stream_executor/cuda/cuda_blas.cc:218] failed to create cublas handle: cublas error
2022-09-21 12:07:27.004071: E external/org_tensorflow/tensorflow/stream_executor/cuda/cuda_blas.cc:220] Failure to initialize cublas may be due to OOM (cublas needs some free memory when you initialize it, and your deep-learning framework may have preallocated more than its fair share), or may be because this binary was not built with support for the GPU in your machine.
2022-09-21 12:07:27.055006: W external/org_tensorflow/tensorflow/compiler/xla/service/gpu/gpu_conv_algorithm_picker.cc:727] None of the algorithms provided by cuDNN heuristics worked; trying fallback algorithms. Conv: (f32[1,16,16,32]{2,1,3,0}, u8[0]{0}) custom-call(f32[1,64,64,6]{2,1,3,0}, f32[8,8,6,32]{1,0,2,3}), window={size=8x8 stride=4x4 pad=2_2x2_2}, dim_labels=b01f_01io->b01f, custom_call_target="__cudnn$convForward", backend_config="{\"conv_result_scale\":1,\"activation_mode\":\"0\",\"side_input_scale\":0}"
Node ThreadWorker(thread=<Thread(learner, stopped daemon 140577552070400)>, future=<Future at 0x7fddde529c40 state=finished raised XlaRuntimeError>) crashed:
Traceback (most recent call last):
…
Profiling failure on cuDNN engine 0: UNKNOWN: CUDNN_STATUS_EXECUTION_FAILED
in external/org_tensorflow/tensorflow/stream_executor/cuda/cuda_dnn.cc(4023): 'cudnnConvolutionForward( cudnn.handle(), alpha, input_nd_.handle(), input_data.opaque(), filter_.handle(), filter_data.opaque(), conv_.handle(), ToConvForwardAlgo(algo), scratch_memory.opaque(), scratch_memory.size(), beta, output_nd_.handle(), output_data.opaque())'
 Profiling failure on cuDNN engine 2#TC: UNKNOWN: CUDNN_STATUS_EXECUTION_FAILED
in external/org_tensorflow/tensorflow/stream_executor/cuda/cuda_dnn.cc(4023): 'cudnnConvolutionForward( cudnn.handle(), alpha, input_nd_.handle(), input_data.opaque(), filter_.handle(), filter_data.opaque(), conv_.handle(), ToConvForwardAlgo(algo), scratch_memory.opaque(), scratch_memory.size(), beta, output_nd_.handle(), output_data.opaque())'
 Profiling failure on cuDNN engine 2: UNKNOWN: CUDNN_STATUS_EXECUTION_FAILED
in external/org_tensorflow/tensorflow/stream_executor/cuda/cuda_dnn.cc(4023): 'cudnnConvolutionForward( cudnn.handle(), alpha, input_nd_.handle(), input_data.opaque(), filter_.handle(), filter_data.opaque(), conv_.handle(), ToConvForwardAlgo(algo), scratch_memory.opaque(), scratch_memory.size(), beta, output_nd_.handle(), output_data.opaque())'
To ignore this failure and try to use a fallback algorithm (which may have suboptimal performance), use XLA_FLAGS=--xla_gpu_strict_conv_algorithm_picker=false. Please also file a bug for the root cause of failing autotuning.

Okay I think the cudnn issues are finally fixed! I posted in the help channel and Kaylee helped me figure it out. Basically I got it working by reinstalling jax using pip install "jax[cuda11_cudnn805]" -f https://storage.googleapis.com/jax-releases/jax_cuda_releases.html
and then also running export XLA_PYTHON_CLIENT_MEM_FRACTION=.7. Neither of these on their own did the trick, but it seems to work when I do both of them. Weirdly, when I look at the gpu usage using watch nvidia-smi, setting XLA_PYTHON_CLIENT_MEM_FRACTION=.7 it doesn’t limit the gpu usage to 70%. It still goes all the way up to 90% percent, but it goes up to 90% a little bit more slowly than if I don’t set XLA_PYTHON_CLIENT_MEM_FRACTION=.7. For some reason this makes it work. Anyway, I’m happy that this finally appears to be solved after spending like two days on this lol. I’ll kick off the image based experiments now

https://github.com/google/jax/discussions/6332#discussioncomment-1279991



================================================================
Actor zero vs slice
================================================================
networks.py
- change last return at end of file and _actor_fn
learning_goals.py
- ctrl + F for policy_network.apply
builder_goals.py
- make actor

================================================================
Val vs no val iterator
================================================================
learning_goals
builder_goals
distributed_layout_goals
Ctrl + F for val, _val, and val_


================================================================
RuntimeError: Failed to initialize OpenGL
on iris5 and iris6
================================================================

libEGL warning: failed to open /dev/dri/renderD129: Permission denied

libEGL warning: failed to open /dev/dri/renderD129: Permission denied

Could not initialize EGL
Loading episode files:   0%|          | 2/4004 [00:00<07:13,  9.24it/s]Node ThreadWorker(thread=<Thread(evaluator, stopped daemon 140327008593664)>, future=<Future at 0x7faa103b5670 state=finished raised RuntimeError>) crashed:
Loading episode files:   0%|          | 9/4004 [00:00<02:05, 31.94it/s]Traceback (most recent call last):
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/launchpad/launch/worker_manager.py", line 474, in _check_workers
    worker.future.result()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/concurrent/futures/_base.py", line 439, in result
    return self.__get_result()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/concurrent/futures/_base.py", line 391, in __get_result
    raise self._exception
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/launchpad/launch/worker_manager.py", line 250, in run_inner
    future.set_result(f())
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/launchpad/nodes/python/node.py", line 75, in _construct_function
    return functools.partial(self._function, *args, **kwargs)()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/launchpad/nodes/courier/node.py", line 130, in run
    instance.run()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/acme/environment_loop.py", line 176, in run
    result = self.run_episode()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/acme/environment_loop.py", line 94, in run_episode
    timestep = self._environment.reset()
  File "/iris/u/khatch/contrastive_rl/contrastive/utils.py", line 313, in reset
    timestep = self._environment.reset()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/acme/wrappers/step_limit.py", line 35, in reset
    return self._environment.reset()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/acme/wrappers/gym_wrapper.py", line 51, in reset
    observation = self._environment.reset()
  File "/iris/u/khatch/contrastive_rl/fetch_envs.py", line 282, in reset
    self._goal_img = self.observation(s)
  File "/iris/u/khatch/contrastive_rl/fetch_envs.py", line 325, in observation
    img = self.render(mode='rgb_array', height=64, width=64)
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/gym/envs/robotics/fetch_env.py", line 230, in render
    return super(FetchEnv, self).render(mode, width, height)
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/gym/envs/robotics/robot_env.py", line 109, in render
    self._get_viewer(mode).render(width, height)
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/gym/envs/robotics/robot_env.py", line 123, in _get_viewer
    self.viewer = mujoco_py.MjRenderContextOffscreen(self.sim, device_id=-1)
  File "mujoco_py/mjrendercontext.pyx", line 46, in mujoco_py.cymj.MjRenderContext.__init__
  File "mujoco_py/mjrendercontext.pyx", line 114, in mujoco_py.cymj.MjRenderContext._setup_opengl_context
  File "mujoco_py/opengl_context.pyx", line 130, in mujoco_py.cymj.OffscreenOpenGLContext.__init__
RuntimeError: Failed to initialize OpenGL
I1005 16:00:56.976415 140370798453952 savers.py:207] Caught SIGTERM: forcing a checkpoint save.
I1005 16:00:56.976747 140370798453952 savers.py:156] Saving checkpoint: /iris/u/khatch/contrastive_rl/results/trash_results/offline_fetch_push_image-goals-no-noise/learner_goals/nonoise_collect_entropy-bc0.5_b1024/seed_0/checkpoints/counter
Loading episode files:   0%|          | 16/4004 [00:00<01:29, 44.40it/s]Exception ignored in: <module 'threading' from '/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/threading.py'>
Traceback (most recent call last):
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/threading.py", line 1447, in _shutdown
    atexit_call()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/launchpad/launch/worker_manager.py", line 428, in wait
    raise failure
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/launchpad/launch/worker_manager.py", line 474, in _check_workers
    worker.future.result()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/concurrent/futures/_base.py", line 439, in result
    return self.__get_result()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/concurrent/futures/_base.py", line 391, in __get_result
    raise self._exception
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/launchpad/launch/worker_manager.py", line 250, in run_inner
    future.set_result(f())
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/launchpad/nodes/python/node.py", line 75, in _construct_function
    return functools.partial(self._function, *args, **kwargs)()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/launchpad/nodes/courier/node.py", line 130, in run
    instance.run()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/acme/environment_loop.py", line 176, in run
    result = self.run_episode()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/acme/environment_loop.py", line 94, in run_episode
    timestep = self._environment.reset()
  File "/iris/u/khatch/contrastive_rl/contrastive/utils.py", line 313, in reset
    timestep = self._environment.reset()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/acme/wrappers/step_limit.py", line 35, in reset
    return self._environment.reset()
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/acme/wrappers/gym_wrapper.py", line 51, in reset
    observation = self._environment.reset()
  File "/iris/u/khatch/contrastive_rl/fetch_envs.py", line 282, in reset
    self._goal_img = self.observation(s)
  File "/iris/u/khatch/contrastive_rl/fetch_envs.py", line 325, in observation
    img = self.render(mode='rgb_array', height=64, width=64)
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/gym/envs/robotics/fetch_env.py", line 230, in render
    return super(FetchEnv, self).render(mode, width, height)
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/gym/envs/robotics/robot_env.py", line 109, in render
    self._get_viewer(mode).render(width, height)
  File "/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/gym/envs/robotics/robot_env.py", line 123, in _get_viewer
    self.viewer = mujoco_py.MjRenderContextOffscreen(self.sim, device_id=-1)
  File "mujoco_py/mjrendercontext.pyx", line 46, in mujoco_py.cymj.MjRenderContext.__init__
  File "mujoco_py/mjrendercontext.pyx", line 114, in mujoco_py.cymj.MjRenderContext._setup_opengl_context
  File "mujoco_py/opengl_context.pyx", line 130, in mujoco_py.cymj.OffscreenOpenGLContext.__init__
RuntimeError: Failed to initialize OpenGL

/iris/u/khatch/anaconda3/envs/crl2/lib/python3.9/site-packages/gym/envs/robotics/robot_env.py
in def _get_viewer, change

self.viewer = mujoco_py.MjRenderContextOffscreen(self.sim, device_id=-1)
to
self.viewer = mujoco_py.MjRenderContextOffscreen(self.sim, device_id=0)

Solution from here: https://github.com/openai/mujoco-py/issues/390#issuecomment-770408780
Some also potentially useful things: https://github.com/openai/mujoco-py/issues/187
Could also try to fix this "libEGL warning: failed to open /dev/dri/renderD129: Permission denied"
https://github.com/deepmind/dm_control/issues/214
